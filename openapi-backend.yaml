openapi: 3.0.3
info:
  title: AgentCore Backend API
  version: 0.1.0
  description: |
    Backend API server with JWT authentication support for AgentCore platform.

    ## Overview
    This API provides endpoints for managing agents, sessions, and user data with 
    JWT-based authentication using Amazon Cognito.

    ## Authentication
    All endpoints (except `/ping` and `/`) require JWT Bearer Token authentication.
    Include the token in the `Authorization: Bearer <JWT-TOKEN>` header.

    ## Features
    - **Agent Management**: Create, update, delete, and share AI agents
    - **Session Management**: Manage conversation sessions and history
    - **Authentication**: JWT verification with Amazon Cognito
    - **Tools & Memory**: Access to MCP tools and AgentCore Memory

  contact:
    name: AgentCore Backend
    url: https://github.com/your-org/fullstack-agentcore
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: http://localhost:3000
    description: Local development environment
  - url: https://{api-id}.execute-api.{region}.amazonaws.com
    description: AWS API Gateway (production)
    variables:
      api-id:
        description: API Gateway ID
        default: default-api
      region:
        description: AWS Region
        enum:
          - us-east-1
          - us-west-2
          - ap-northeast-1
        default: us-east-1

paths:
  /:
    get:
      summary: Get API Information
      description: Returns basic information about the Backend API service
      operationId: getApiInfo
      tags:
        - Service
      responses:
        '200':
          description: API information
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiInfo'

  /ping:
    get:
      summary: Health Check
      description: Check if the service is running and healthy
      operationId: healthCheck
      tags:
        - Health
      responses:
        '200':
          description: Service is healthy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthCheck'

  /me:
    get:
      summary: Get Current User Information
      description: Returns information about the authenticated user from JWT token
      operationId: getCurrentUser
      tags:
        - User
      security:
        - bearerAuth: []
      responses:
        '200':
          description: User information retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserInfo'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /agents:
    get:
      summary: List User's Agents
      description: Retrieve all agents belonging to the authenticated user
      operationId: listAgents
      tags:
        - Agents
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Agent list retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AgentListResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '500':
          $ref: '#/components/responses/InternalServerError'

    post:
      summary: Create New Agent
      description: Create a new AI agent with custom configuration
      operationId: createAgent
      tags:
        - Agents
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateAgentInput'
      responses:
        '201':
          description: Agent created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AgentResponse'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /agents/initialize:
    post:
      summary: Initialize Default Agents
      description: Create default agents for first-time users
      operationId: initializeDefaultAgents
      tags:
        - Agents
      security:
        - bearerAuth: []
      responses:
        '201':
          description: Default agents created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AgentListResponse'
        '200':
          description: Initialization skipped (agents already exist)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AgentListResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /agents/{agentId}:
    get:
      summary: Get Agent Details
      description: Retrieve detailed information about a specific agent
      operationId: getAgent
      tags:
        - Agents
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/AgentId'
      responses:
        '200':
          description: Agent retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AgentResponse'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

    put:
      summary: Update Agent
      description: Update an existing agent's configuration
      operationId: updateAgent
      tags:
        - Agents
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/AgentId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateAgentInput'
      responses:
        '200':
          description: Agent updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AgentResponse'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

    delete:
      summary: Delete Agent
      description: Delete an agent permanently
      operationId: deleteAgent
      tags:
        - Agents
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/AgentId'
      responses:
        '200':
          description: Agent deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /agents/{agentId}/share:
    put:
      summary: Toggle Agent Share Status
      description: Enable or disable sharing of an agent with other users
      operationId: toggleAgentShare
      tags:
        - Agents
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/AgentId'
      responses:
        '200':
          description: Share status toggled successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AgentResponse'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /agents/shared-agents/list:
    get:
      summary: List Shared Agents
      description: Retrieve publicly shared agents from all users with pagination
      operationId: listSharedAgents
      tags:
        - Agents
      security:
        - bearerAuth: []
      parameters:
        - name: q
          in: query
          description: Search query string
          schema:
            type: string
        - name: limit
          in: query
          description: Number of items to retrieve
          schema:
            type: integer
            default: 20
            minimum: 1
            maximum: 100
        - name: cursor
          in: query
          description: Pagination cursor
          schema:
            type: string
      responses:
        '200':
          description: Shared agents retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SharedAgentListResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /agents/shared-agents/{userId}/{agentId}:
    get:
      summary: Get Shared Agent Details
      description: Retrieve details of a specific shared agent
      operationId: getSharedAgent
      tags:
        - Agents
      security:
        - bearerAuth: []
      parameters:
        - name: userId
          in: path
          required: true
          description: Owner's user ID
          schema:
            type: string
        - name: agentId
          in: path
          required: true
          description: Agent ID
          schema:
            type: string
      responses:
        '200':
          description: Shared agent retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SharedAgentResponse'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /agents/shared-agents/{userId}/{agentId}/clone:
    post:
      summary: Clone Shared Agent
      description: Create a copy of a shared agent for the current user
      operationId: cloneSharedAgent
      tags:
        - Agents
      security:
        - bearerAuth: []
      parameters:
        - name: userId
          in: path
          required: true
          description: Original owner's user ID
          schema:
            type: string
        - name: agentId
          in: path
          required: true
          description: Agent ID to clone
          schema:
            type: string
      responses:
        '201':
          description: Agent cloned successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AgentResponse'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /sessions:
    get:
      summary: List User's Sessions
      description: Retrieve all conversation sessions for the authenticated user
      operationId: listSessions
      tags:
        - Sessions
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Session list retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SessionListResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /sessions/{sessionId}/events:
    get:
      summary: Get Session Conversation History
      description: Retrieve all conversation events for a specific session
      operationId: getSessionEvents
      tags:
        - Sessions
      security:
        - bearerAuth: []
      parameters:
        - name: sessionId
          in: path
          required: true
          description: Session ID
          schema:
            type: string
      responses:
        '200':
          description: Conversation history retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SessionEventsResponse'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: |
        JWT Bearer Token authentication using Amazon Cognito.
        Include the token in the Authorization header: `Bearer <token>`

  parameters:
    AgentId:
      name: agentId
      in: path
      required: true
      description: Unique agent identifier
      schema:
        type: string
        pattern: '^[a-zA-Z0-9-_]+$'

  schemas:
    # === Common Schemas ===
    ApiInfo:
      type: object
      properties:
        service:
          type: string
          example: 'AgentCore Backend API'
        version:
          type: string
          example: '0.1.0'
        environment:
          type: string
          enum: [development, production]
          example: 'development'
        endpoints:
          type: object
          properties:
            health:
              type: string
              example: 'GET /ping'
            userInfo:
              type: string
              example: 'GET /me (requires Authorization header)'
        documentation:
          type: object
          properties:
            authentication:
              type: string
              example: 'JWT Bearer token in Authorization header'
            format:
              type: string
              example: 'Authorization: Bearer <jwt_token>'
        timestamp:
          type: string
          format: date-time

    HealthCheck:
      type: object
      properties:
        status:
          type: string
          enum: [healthy, unhealthy]
          example: 'healthy'
        timestamp:
          type: string
          format: date-time
        uptime:
          type: number
          description: Server uptime in seconds
          example: 123.456
        service:
          type: string
          example: 'agentcore-backend'
        version:
          type: string
          example: '0.1.0'
        environment:
          type: string
          example: 'development'
        jwks:
          type: object
          properties:
            configured:
              type: boolean
            uri:
              type: string
              nullable: true

    UserInfo:
      type: object
      properties:
        authenticated:
          type: boolean
        user:
          type: object
          properties:
            id:
              type: string
            username:
              type: string
            email:
              type: string
            groups:
              type: array
              items:
                type: string
        jwt:
          type: object
          properties:
            tokenUse:
              type: string
              enum: [access, id]
            issuer:
              type: string
            audience:
              type: string
            issuedAt:
              type: string
              format: date-time
            expiresAt:
              type: string
              format: date-time
            clientId:
              type: string
            authTime:
              type: string
              format: date-time
        request:
          type: object
          properties:
            id:
              type: string
            timestamp:
              type: string
              format: date-time
            ip:
              type: string
            userAgent:
              type: string

    # === Agent Schemas ===
    Agent:
      type: object
      properties:
        id:
          type: string
          description: Unique agent identifier
        name:
          type: string
          description: Agent display name
        description:
          type: string
          description: Agent description
        icon:
          type: string
          description: Icon name
        systemPrompt:
          type: string
          description: System prompt for the agent
        enabledTools:
          type: array
          items:
            type: string
          description: List of enabled tool names
        scenarios:
          type: array
          items:
            $ref: '#/components/schemas/Scenario'
        isShared:
          type: boolean
          description: Whether the agent is shared with other users
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
        createdBy:
          type: string
          description: Creator's username

    SharedAgent:
      allOf:
        - $ref: '#/components/schemas/Agent'
        - type: object
          properties:
            userId:
              type: string
              description: Owner's user ID

    Scenario:
      type: object
      properties:
        title:
          type: string
        prompt:
          type: string

    CreateAgentInput:
      type: object
      required:
        - name
        - description
        - systemPrompt
        - enabledTools
      properties:
        name:
          type: string
          minLength: 1
          maxLength: 100
        description:
          type: string
          minLength: 1
          maxLength: 500
        icon:
          type: string
        systemPrompt:
          type: string
          minLength: 1
        enabledTools:
          type: array
          items:
            type: string
        scenarios:
          type: array
          items:
            $ref: '#/components/schemas/Scenario'

    UpdateAgentInput:
      type: object
      properties:
        name:
          type: string
        description:
          type: string
        icon:
          type: string
        systemPrompt:
          type: string
        enabledTools:
          type: array
          items:
            type: string
        scenarios:
          type: array
          items:
            $ref: '#/components/schemas/Scenario'

    AgentResponse:
      type: object
      properties:
        agent:
          $ref: '#/components/schemas/Agent'
        metadata:
          $ref: '#/components/schemas/ResponseMetadata'

    AgentListResponse:
      type: object
      properties:
        agents:
          type: array
          items:
            $ref: '#/components/schemas/Agent'
        skipped:
          type: boolean
          description: Whether initialization was skipped
        message:
          type: string
        metadata:
          allOf:
            - $ref: '#/components/schemas/ResponseMetadata'
            - type: object
              properties:
                count:
                  type: integer

    SharedAgentResponse:
      type: object
      properties:
        agent:
          $ref: '#/components/schemas/SharedAgent'
        metadata:
          $ref: '#/components/schemas/ResponseMetadata'

    SharedAgentListResponse:
      type: object
      properties:
        agents:
          type: array
          items:
            $ref: '#/components/schemas/SharedAgent'
        nextCursor:
          type: string
          nullable: true
        hasMore:
          type: boolean
        metadata:
          allOf:
            - $ref: '#/components/schemas/ResponseMetadata'
            - type: object
              properties:
                count:
                  type: integer

    # === Session Schemas ===
    Session:
      type: object
      properties:
        sessionId:
          type: string
        actorId:
          type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
        messageCount:
          type: integer

    SessionListResponse:
      type: object
      properties:
        sessions:
          type: array
          items:
            $ref: '#/components/schemas/Session'
        metadata:
          allOf:
            - $ref: '#/components/schemas/ResponseMetadata'
            - type: object
              properties:
                actorId:
                  type: string
                count:
                  type: integer

    SessionEvent:
      type: object
      properties:
        eventId:
          type: string
        sessionId:
          type: string
        timestamp:
          type: string
          format: date-time
        role:
          type: string
          enum: [user, assistant, system]
        content:
          type: array
          items:
            type: object

    SessionEventsResponse:
      type: object
      properties:
        events:
          type: array
          items:
            $ref: '#/components/schemas/SessionEvent'
        metadata:
          allOf:
            - $ref: '#/components/schemas/ResponseMetadata'
            - type: object
              properties:
                actorId:
                  type: string
                sessionId:
                  type: string
                count:
                  type: integer

    # === Response Metadata ===
    ResponseMetadata:
      type: object
      properties:
        requestId:
          type: string
        timestamp:
          type: string
          format: date-time
        userId:
          type: string

    SuccessResponse:
      type: object
      properties:
        success:
          type: boolean
        metadata:
          $ref: '#/components/schemas/ResponseMetadata'

    # === Error Schemas ===
    ErrorResponse:
      type: object
      required:
        - error
      properties:
        error:
          type: string
        message:
          type: string
        requestId:
          type: string
        timestamp:
          type: string
          format: date-time

  responses:
    BadRequestError:
      description: Bad Request - Invalid input parameters
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            error: 'Invalid request'
            message: 'Required fields are missing'
            requestId: 'req-abc123'

    UnauthorizedError:
      description: Unauthorized - Invalid or missing JWT token
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            error: 'Authentication Error'
            message: 'Authorization header is required'
            code: 'MISSING_AUTHORIZATION'
            requestId: 'req-abc123'

    NotFoundError:
      description: Not Found - Resource does not exist
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            error: 'Not Found'
            message: 'Agent not found'
            requestId: 'req-abc123'

    InternalServerError:
      description: Internal Server Error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            error: 'Internal Server Error'
            message: 'An unexpected error occurred'
            requestId: 'req-abc123'

security:
  - bearerAuth: []

tags:
  - name: Health
    description: Health check endpoints
  - name: Service
    description: Service information
  - name: User
    description: User information and authentication
  - name: Agents
    description: Agent management endpoints
  - name: Sessions
    description: Conversation session management
